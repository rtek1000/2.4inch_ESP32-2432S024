!function(){const e=4e3;function t(n,o){if((o=o||{}).error="function"==typeof o.error?o.error:t.noop,o.playing="function"==typeof o.playing?o.playing:t.noop,o.pause="function"==typeof o.pause?o.pause:t.noop,o.canplay="function"==typeof o.canplay?o.canplay:t.noop,o.ready="function"==typeof o.ready?o.ready:t.noop,o.ended="function"==typeof o.ended?o.ended:t.noop,o.seeked="function"==typeof o.seeked?o.seeked:t.noop,o.timeupdate="function"==typeof o.timeupdate?o.timeupdate:t.noop,o.playNext="function"==typeof o.playNext?o.playNext:t.noop,o.playPrev="function"==typeof o.playPrev?o.playPrev:t.noop,!n.videoElement)return void o.error("no video element.");if(!videojs)return void o.error(" videojs is undefined.");let i=null,l=n.videoElement;if(!l.id)return void console.error("请给video-js元素设置id属性");let a=l.id,r=n.isMobile||!1,s=n.qualityLevel,c=r?["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","customControlSpacer","fullscreenToggle"]:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","pictureInPictureToggle","customControlSpacer","fullscreenToggle"],u={controls:!0,autoplay:!1,playsinline:!0,bigPlayButton:!0,playNextButton:!1,playPrevButton:!1,playEndMask:!1,aspectRatio:"4:3",liveui:!0,controlBar:{children:n.config.controlBars||c}},d=n.config?Object.assign(u,n.config):u,p=d&&d.sources&&d.sources[0]||null,v=n.reportInterval||1e4,y=!1;void 0!==d.loop&&(y=d.loop,d.loop=!1);let f=Z(".vjs-big-play-button"),m=Z(".click-mask .play-btn"),h=0,g=null,j=null,b=r?144:480,k=!0,T=[],N=0,q=null,E=!1,x=!1,L=parseInt(Date.parse(new Date)/1e3),M=new Date,B=0,w=0,P=[],D="",A=!1,I=0,H=[],S=!1;function C(){i.on("waiting",(function(){w++,P[w-1]={start:(new Date).getTime()}})),i.on("error",(function(e){D=e.target.player.error_.message,$("error")})),i.on("loadeddata",(function(){if(B||(B=new Date-M),!S){S=!0;try{let e=b;const t=T;1===s?e=t[0]:3===s&&(e=t[t.length-1]);let n=Z(".quality-level-"+e);s&&n&&n.click()}catch(e){}}if(d.playEndMask)try{X(document.querySelector("#endMask"),"active")}catch(e){}})),i.on("play",(function(){if(d.playEndMask)try{X(document.querySelector("#endMask"),"active")}catch(e){}let e=Math.round(i.currentTime());!x&&E&&e>N&&(N=e,$("play")),x=!0})),i.on("canplay",(function(){P[w-1]&&P[w-1].start&&!P[w-1].end&&(P[w-1].end=(new Date).getTime()),E=!0,r&&i.paused()&&f&&(f.style.display="block"),o.canplay&&o.canplay()})),i.on("playing",(function(){r&&(f&&(f.style.display="none"),h||(h=1,m&&G(m),g&&clearTimeout(g),g=setTimeout((function(){U(),clearTimeout(g)}),e))),o.playing&&o.playing()})),i.on("pause",(function(){r&&h&&(h=0,g&&clearTimeout(g),_(),m&&G(m)),o.pause&&o.pause()})),i.on("ended",(function(){q&&clearInterval(q);let e=Math.round(i.currentTime());e>N&&(N=e,$("ended")),y&&i.play(),d.playEndMask&&W(document.querySelector("#endMask"),"active"),o.ended&&o.ended()})),i.on("timeupdate",(function(){q||(q=setInterval((()=>{let e=Math.round(i.currentTime());e>N&&(N=e,$("timeupdate"))}),v)),o.timeupdate&&o.timeupdate()})),i.on("seeking",(function(){J(!0)})),i.on("seeked",(function(){J(!1),I++,o.seeked&&o.seeked()}))}function $(e){let t=parseInt(Date.parse(new Date)/1e3);const{videoId:n,typeId:o}=function(e){let t=e.split("/"),n=t.length;return{videoId:n>=3?t[n-2]:0,typeId:n>=3?t[n-3].substr(0,t[n-3].length-6):0}}(d.sources[0].src);let l=`https://${i&&i.src().indexOf("testvodcdn")>=0?"testvod":"vod"}.ecerimg.com/view_count/report`,a=isNaN(o),s=function(){const e=navigator.userAgent||navigator.vendor;return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini|mobile|tablet|ipad|playbook|silk/i.test(e)}();null!=typeof window.playerReportUrl&&window.playerReportUrl&&(l=window.playerReportUrl);let c={timestamp:t,type_id:a?0:parseInt(o),sign:videojs.md5(""+o+t+"EcerVideo#2o22"),video_id:n,sid:videojs.md5(""+o+n+L),device:~~r||~~s,duration:Math.round(i&&i.duration()||0),pos:Math.round(i&&i.currentTime()||0),from:location.href,reportType:e,version:"1.1.1",stat:{openTime:B,buffered:i&&i.buffered().end(0)||0,resolution:H.join(","),waitingTime:O(P)||"",errorMsg:D,seekTimes:I}};a&&Object.assign(c,{source:d.sources[0].src}),A||(A=!0,c.stat.userAgent=navigator&&navigator.userAgent||""),videojs.xhr({method:"POST",body:JSON.stringify(c),url:l},(function(e,t,n){}))}function O(e){let t=[];return e.forEach((function(e){e.end&&e.start&&t.push(e.end-e.start)})),t.join(",")}function R(){m=Z(".click-mask .play-btn"),m&&m.addEventListener("touchend",(function(e){let t=Z("video");g&&clearTimeout(g),h?t.pause():t.play()}))}function U(){try{X(l,"active");let e=Z(".vjs-quality");e&&X(e,"active")}catch(e){}}function _(){W(l,"active")}function G(e){K(e,"playing")?(X(e,"playing"),W(e,"paused")):(X(e,"paused"),W(e,"playing"))}function J(e){try{l&&(e?W(l,"seek-active"):X(l,"seek-active"))}catch(e){}}function Q(){return new Promise((async t=>{let n=Z(".vjs-control-bar"),o=document.createElement("div");o.classList="vjs-quality vjs-menu-button vjs-menu-button-popup vjs-control vjs-button ",o.title="Quality",o.innerHTML='<div class="vjs-quality-value"></div>\n          <div class="vjs-menu">\n            <ul class="vjs-menu-content"></ul>\n          </div>';let l=Z(".vjs-control-bar .vjs-progress-control");l?n&&n.insertBefore(o,l.nextSibling):n&&n.childNodes&&n.insertBefore(o,n.childNodes[n.childNodes.length-1]);let a=Z(".vjs-quality .vjs-menu-content"),s=Z(".vjs-quality"),c=Z(".vjs-quality-value");if(r)z(a,T),T.forEach((e=>{V(e,a,T)})),c&&(c.innerHTML="Auto",c.addEventListener("touchend",(function(t){t.preventDefault(),t.cancelBubble=!0,t.stopPropagation(),Y(s,"active"),j&&clearTimeout(j),j=setTimeout((function(){X(s,"active")}),e)})));else{if(ee())z(a,T),c&&(c.innerHTML="Auto"),T.forEach((e=>{V(e,a,T)})),H.push(b);else{let e=i.qualityLevels();c&&(c.innerHTML="Auto"),z(a,e),T.length>1&&e.on("addqualitylevel",(function(t){V(t.qualityLevel,a,e)})),e.on("change",(function(t){var n=e[t.selectedIndex];H.push(n.height),Z(".vjs-quality-value")&&(Z(".vjs-quality-value").innerHTML=k?"Auto":n.height+"p")}))}c&&c.addEventListener("click",(function(e){Y(s,"active"),j&&clearTimeout(j),j=setTimeout((function(){X(s,"active")}),3e3)}))}t()}))}function V(e,t,n){let o=document.createElement("li"),l=document.createElement("button"),a=Z(".vjs-quality");if(r||ee())l.innerHTML=e+"p",l.className=`quality-level-${e}`,l.onclick=function(){let t=Z(".vjs-quality li",!0);X(a,"active"),Array.from(t).forEach((function(e){X(e,"selected")})),W(l.parentNode,"selected"),Z(".vjs-quality-value")&&(Z(".vjs-quality-value").innerHTML=e+"p"),H.push(e),J(!0);var n=i.ended()?0:i.currentTime();let o=p.src.replace("/playlist.m3u8",`/${parseInt(e)}/index.m3u8`);i.src({src:o,type:"application/x-mpegURL"}),i.currentTime(n),i.play()};else{if(ee())return;l.innerHTML=e.height+"p",l.className="quality-level-"+e.height,l.onclick=function(t){let o=Z(".quality-level-auto");k=!1,e.enabled=!0;for(var i=0;i<n.length;i++){n[i]!==e&&(n[i].enabled=!1),X(o.parentNode,"selected"),X(a,"active");var l=Z(`.quality-level-${n[i].height}`);l&&X(l.parentNode,"selected")}W(t.target.parentNode,"selected"),Z(".vjs-quality-value")&&(Z(".vjs-quality-value").innerHTML=t.target.innerText)}}o.appendChild(l),t&&t.insertBefore(o,t.childNodes[0])}function z(e,t){let n=document.createElement("li"),o=document.createElement("button");o.innerHTML="Auto",o.className="quality-level-auto",n.className="selected",o.onclick=function(e){k=!0;let n=Z(".vjs-quality"),l=Z(".vjs-quality li",!0);if(X(n,"active"),Array.from(l).forEach((e=>{X(e,"selected")})),W(o.parentNode,"selected"),Z(".vjs-quality-value")&&(Z(".vjs-quality-value").innerHTML="Auto"),r||ee()){J(!0);var a=i.ended()?0:i.currentTime();let e=r?p.src.replace("/playlist.m3u8","/m_playlist.m3u8"):p.src;i.src({src:e,type:"application/x-mpegURL"}),i.currentTime(a),i.play()}else for(var s=0;s<t.length;s++){t[s].enabled=!0;var c=Z(`.quality-level-${t[s].height}`);c&&X(c.parentNode,"selected")}},n.appendChild(o),e&&e.appendChild(n)}function F(e){return new Promise((t=>{if(!e)return console.warn("source is ",e),void t([]);videojs.xhr({method:"GET",url:e},(function(e,n,o){if(o){let e=o.split("\n").filter((e=>e.indexOf("m3u8")>-1&&e.match(/^[0-9]/g)));e=e.map((e=>e.split("/")[0])),t(e)}else t([])}))}))}function K(e,t){return!(!e||!t)&&e.classList.contains(t)}function W(e,t){e&&t&&e.classList.add(t)}function X(e,t){e&&t&&K(e,t)&&e.classList.remove(t)}function Y(e,t){K(e,t)?X(e,t):W(e,t)}function Z(e,t){return t?document.querySelectorAll(`#${a} ${e}`):document.querySelector(`#${a} ${e}`)}function ee(){let e=navigator.userAgent.toLowerCase();return e.indexOf("macintosh")>-1&&e.indexOf("version/")>0&&e.indexOf("safari/")>-1}!d.sources||d.controlBar.children.length?(r?F(d.sources[0].src).then((t=>{T=t,T.find((e=>e==b))||(b=T[0]),d.sources=[{src:d.sources[0].src.replace("/playlist.m3u8","/m_playlist.m3u8"),type:"application/x-mpegURL"}],i=this.Player=videojs(l,d,(function(){f=Z(".vjs-big-play-button"),m=Z(".click-mask .play-btn"),C(),Z(".click-mask")||function(){let t=document.createElement("div");t.className="click-mask";let n=document.createElement("div");n.className="play-btn paused",t.appendChild(n),l&&l.appendChild(t),function(){let t=Z(".click-mask");t&&t.addEventListener("touchend",(function(t){t.preventDefault(),K(l,"active")?U():(_(),h&&(g&&clearTimeout(g),g=setTimeout((function(){U(),clearTimeout(g)}),e)));let n=Z("video");h?n.pause():n.play()}))}(),R()}(),Z(".seeking-mask")||function(){let e=document.createElement("div");e.className="seeking-mask";let t=Z(".vjs-loading-spinner");t&&l&&t.parentNode.insertBefore(e,t)}(),Z(".vjs-quality")||Q(),o.ready&&o.ready()}))})):F(d.sources[0].src).then((e=>{T=e,ee()&&(T.find((e=>e==b))||(b=T[0])),i=this.Player=videojs(l,d,(function(){if(f=Z(".vjs-big-play-button"),m=Z(".click-mask .play-btn"),C(),Z(".vjs-quality")||Q(),Z(".vjs-space-box")||function(){let e=Z(".vjs-control-bar"),t=Z(".vjs-control-bar .vjs-progress-control"),n=document.createElement("div");n.classList="vjs-space-box",t?e&&e.insertBefore(n,t.nextSibling):e&&e.childNodes&&e.insertBefore(n,e.childNodes[e.childNodes.length-1])}(),d.playEndMask){if("boolean"!=typeof d.playEndMask)return void console.error("playEndMask parameter type error.");Z(".play-end-mask")||function(){let e=document.querySelector(`#${a}`),t=Z(".vjs-control-bar"),n=document.createElement("div");n.className="play-end-mask",n.id="endMask",t?e&&e.insertBefore(n,t):e&&e.childNodes&&e.insertBefore(n,e.childNodes[e.childNodes.length-1])}()}if(d.playNextButton){if("boolean"!=typeof d.playNextButton)return void console.error("playNextButton parameter type error.");Z(".vjs-play-next-control")||function(){let e=Z(".vjs-control-bar"),t=Z(".vjs-control-bar .vjs-play-control"),n=document.createElement("button");n.title="play next",n.setAttribute("type","button"),n.classList="vjs-play-next-control vjs-control vjs-button",n.innerHTML='<span class="vjs-icon-placeholder" aria-hidden="true"></span><span class="vjs-control-text" aria-live="polite">Play next</span>',n.addEventListener("click",(function(){o.playNext&&o.playNext()})),t?e&&e.insertBefore(n,t.nextSibling):e&&e.childNodes&&e.insertBefore(n,e.childNodes[e.childNodes.length-1])}()}if(d.playPrevButton){if("boolean"!=typeof d.playPrevButton)return void console.error("playPrevButton parameter type error.");Z(".vjs-play-prev-control")||function(){let e=Z(".vjs-control-bar"),t=Z(".vjs-control-bar .vjs-play-control"),n=document.createElement("button");n.title="play prev",n.setAttribute("type","button"),n.classList="vjs-play-prev-control vjs-control vjs-button",n.innerHTML='<span class="vjs-icon-placeholder" aria-hidden="true"></span><span class="vjs-control-text" aria-live="polite">Play next</span>',n.addEventListener("click",(function(){o.playPrev&&o.playPrev()})),t?e&&e.insertBefore(n,t):e&&e.childNodes&&e.insertBefore(n,e.childNodes[e.childNodes.length-1])}()}o.ready&&o.ready()}))})),this.destroy=function(){q&&(clearInterval(q),q=null),i&&i.dispose(),l&&l.remove()}):o.error("videojs config error.")}t.noop=function(){},window.EPlayer=t}();